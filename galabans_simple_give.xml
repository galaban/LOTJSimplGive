<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Friday, March 04, 2016, 7:22 AM -->
<!-- MuClient version 4.94 -->

<!-- Plugin "Galabans_Simple_Give" generated by Plugin Wizard -->

<muclient>
<plugin
   name="Galabans_Simple_Give"
   author="galaban"
   id="1559876f89e24dbf07374dc1"
   language="Lua"
   purpose="automatically approach if needed"
   save_state="y"
   date_written="2016-03-04 07:20:36"
   requires="4.60"
   version="1.0"
   >

</plugin>


<!--  Triggers  -->

<triggers>

  <!-- triggers for watching our status after we enter the "give" command -->
  <trigger
   group="giveChecks"
   enabled="n"
   match="You are already close to *."
   send_to="12"
   sequence="100"
   script="approachDone"
  />

  <trigger
   group="giveChecks"
   enabled="n"
   match="You're too far away! Get closer!"
   send_to="12"
   sequence="100"
   script="needApproach"
  />

  <trigger
   group="giveChecks"
   enabled="n"
   match="You give *"
   send_to="12"
   sequence="100"
   script="gaveDone"
  />
  <trigger
   group="giveChecks"
   enabled="n"
   match="You do not have that item."
   send_to="12"
   sequence="100"
   script="gaveDone"
  />

  <!-- always-on triggers for monitoring approaches -->
  <trigger
   enabled="y"
   match="You can't seem to find anyone like that nearby."
   send_to="12"
   sequence="100"
   script="approachCancel"
  />

  <trigger
   enabled="y"
   match="Damn, they must have left!"
   send_to="12"
   sequence="100"
   script="approachCancel"
  />

  <trigger
   enabled="y"
   match="You step closer to *"
   send_to="12"
   sequence="100"
   script="approachDone"
  />

  <trigger
   enabled="y"
   match="You stop suddenly."
   send_to="12"
   sequence="100"
   script="approachCancel"
  />

  <trigger
   enabled="y"
   match="You begin approaching *."
   send_to="12"
   sequence="100"
   script="approachStart"
  />

</triggers>

<!--  Aliases  -->

<aliases>
  <alias
   match="give * *"
   enabled="y"
   expand_variables="y"
   group="BOT"
   send_to="12"
   sequence="100"
  >
  <send>autoGive("%1", "%2")</send>
  </alias>
</aliases>

<!--  Script  -->


<script>
<![CDATA[


------------------------
--  AutoGive
--
local closeto = ""
local approaching = ""
local approachCmd = ""
local giveCmd = ""
local tmpGive = nil

function autoGive(object, person)

    EnableTriggerGroup("giveChecks", true)
    approachCmd = ""
    giveCmd = ""
    if (closeto == "" or string.find(closeto, person) == nil) then        
        tmpGive = object .. " " ..person
        Send("approach "..person)
    else
        approachCmd = person
        giveCmd = object

        Send("give "..object .. " " ..person)
    end
end

function needApproach()
    if (approachCmd == "") then return end
    Send("approach "..approachCmd)

    tmpGive = giveCmd .. " " ..approachCmd

    approachCmd = ""
    giveCmd = ""
end

function gaveDone()
    EnableTriggerGroup("give", false)
end

function approachStart(rName, rLine, rWildcards)
    approaching = string.lower(rWildcards[1])
end

function approachDone()

    EnableTriggerGroup("give", false)

    --stack them so that the string.find will find them
    closeto = closeto.." " ..approaching

    approaching = ""
    approachCmd = ""
    giveCmd = ""

    if (tmpGive == nil) then
        return
    end

    Send("give "..tmpGive)
    tmpGive = nil
end

function approachCancel()
    clearCommands()
end

function clearCommands()
	closeto = ""
    approaching = ""
    approachCmd = ""
    giveCmd = ""
    tmpGive = nil
    EnableTriggerGroup("giveChecks",false)
end

function string.starts(String,Start)
   return string.sub(String,1,string.len(Start))==Start
end

function OnPluginBroadcast (msg, id, name, text)
	if (id == 'b3aae34498d5bf19b5b2e2af') then
		if (text == "reload") then
            clearCommands()
		end
		if (string.starts(text,"ROOMVNUM")) then
            clearCommands()
        end
		return
  end
end


Note("[Galabans Simple Give Script loaded.]")

]]>
</script>


</muclient>
